<!DOCTYPE html><html lang=es><head><meta charset=UTF-8 /><meta http-equiv=X-UA-Compatible content="IE=edge" /><meta name=viewport content="width=device-width, initial-scale=1.0" /><link rel=preconnect href=https://fonts.googleapis.com /><link rel=preconnect href=https://fonts.gstatic.com crossorigin /><link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel=stylesheet /><style>*{--background:white;--first-color:#0057a4;--second-color:#ffdb01;padding:0;margin:0;font-family:'Roboto',sans-serif;box-sizing:border-box}body{background-color:var(--background)}div.container{padding:.5rem;display:flex;flex-direction:column}.no-visible{display:none}.margen-alta-05{margin-top:.5rem}.ancho-100{width:100%}.margen-bajo{margin-bottom:.5rem}.centrar{text-align:center}h1,h4{margin:auto;padding:auto}div p.version{position:fixed;bottom:.5rem;right:.5rem;font-size:.7rem;color:#d3d3d3}h1{font-weight:bolder}ol{padding-left:2rem}input[type="file"],input[type='button']{display:none}label{display:inline-block}div label.custom-button{border-radius:4px;background-color:var(--first-color);color:var(--second-color);cursor:pointer;font-size:1rem;margin:.3rem auto;padding:.3rem .6rem;text-align:center}div label.custom-button:hover{background-color:var(--second-color);color:var(--first-color)}ul li{list-style-type:none;margin-bottom:.3rem;padding-left:auto}.custom-radio{display:inline-flex;align-items:center;cursor:pointer}label.custom-radio>input[type="radio"]{display:none}.custom-radio-show{position:relative;background-color:var(--first-color);border-radius:50%;width:1rem;height:1rem}.custom-radio-show::after{position:absolute;content:"";background-color:var(--background);top:12.5%;left:12.5%;width:75%;height:75%;border-radius:50%}.custom-radio>input[type="radio"]:checked~.custom-radio{background-color:var(--first-color);color:var(--second-color)}.custom-radio>input[type="radio"]:checked+.custom-radio-show::after{position:absolute;content:"";background-color:var(--second-color);top:12.5%;left:12.5%;width:75%;height:75%;border-radius:50%}span.custom-radio-text{margin-left:.3rem;padding:0 .2rem}div.loading-frame{position:absolute;top:0;left:0;width:100%;height:100%;backdrop-filter:blur(5px)}div.loading-frame div.loading{position:relative;background-color:var(--first-color);color:var(--second-color);text-align:center;max-width:40%;margin:auto;top:50%;padding:2rem;border-radius:5px;transform:translate(-0%,-50%);-webkit-transform:translate(-0%,-50%)}div.loading p{margin:auto;font-weight:bold;font-size:larger}table{border-collapse:collapse;border:2px solid var(--first-color)}th,td{border-bottom:1px solid #808080}tr:nth-last-of-type(2n+0){background-color:#d3d3d3}tbody tr:hover,tbody tr.editable{background-color:#ffdb01}tbody tr:hover td[contentEditable]{color:var(--second-color);background-color:var(--first-color)}.cabecera{background-color:var(--first-color);color:var(--second-color)}.resaltar{background-color:var(--second-color)}@media print{body,html{height:100%;background-color:#fff !important;color:#000 !important}.hide-print{display:none !important}.cabecera{background-color:#fff;color:#000}.borde{border:2px solid #000}}</style><title>Carga y lectura archivo de texto en Javascript</title></head><body><div class="container margen-alta-05"><h1 class=margen-bajo>Revisión de Inventario</h1><p class=hide-print><strong>Objetivo: </strong>Verificación de stock de referencias especificas.</p></div><div class="container hide-print"><ol><li><label for="">Seleccionar archivo de datos:</label><div class=ancho-100> <label class=custom-button id=upload-file-b for=file-input>Subir archivo...</label><input type=file id=file-input /></div></li><li><label class=margen-bajo for="">Seleccione el dia de la semana:</label><div><ul><li> <label for=estateOne class=custom-radio><input type=radio name=estate id=estateOne value=estateOne checked /> <span class="custom-radio custom-radio-show"></span> <span class="custom-radio custom-radio-text">Lunes / Jueves</span></label></li><li><label for=estateTwo class=custom-radio><input type=radio name=estate id=estateTwo value=estateTwo /><span class="custom-radio custom-radio-show"></span> <span class="custom-radio custom-radio-text">Martes / Viernes</span></label></li><li><label for=estateThree class=custom-radio><input type=radio name=estate id=estateThree value=estateThree /><span class="custom-radio custom-radio-show"></span> <span class="custom-radio custom-radio-text">Miercóles / Sábado</span></label></li></ul></div></li><li><label for="">Analizar el archivo seleccionado:</label><div> <label class=custom-button for=process-file>Procesar archivo</label><input id=process-file type=button value="Procesar Archivo" /></div></li><li><label for="">Editar ubicaciones de venta e imprimir el documento:</label><div> <label for="" class=custom-button id=print-button>Imprimir resultados</label></div></li></ol></div><div class="loading-frame no-visible" id=loading-frame><div class=loading><p id=loading>Cargando...</p></div></div><div class=container><table id=data-table class="borde margen-bajo"><thead><tr class="cabecera centrar borde"><th>No.</th><th>HFB</th><th>Descripción</th><th>Stock</th><th>Art. No.</th><th>Lugar de Venta</th></tr></thead><tbody id=data-body></tbody></table><div><h4 class="margen-bajo centrar">Final de la Tabla</h4></div></div><div><p class=version>Versión 1.1</p></div><script>function estateSelected(){for(let n=0;n<radioButtons.length;n++)if(radioButtons[n].checked)return radioButtons[n].value;return null}function openFile(n){console.clear();let t=n.target.files[0];(t=verifyTextFile(t),t)&&(fileReader.readAsText(t),document.getElementById("upload-file-b").innerText=t.name)}function loadingInfo(n){if(n.loaded&&n.total){const t=n.loaded/n.total*100,i=`Cargando... ${Math.round(t)}%`;loading.innerText=i}}function loadFile(){if(contentOriginal.length<=0){if(!readDataFromFile())return;filterColumns();contentOriginal=verifySalesMethodTwo()}content=contentOriginal;let n=estateSelected();if(!n){console.log("Error en la seleccion del dia de la semana(estado).");return}processContent(n);showContent()}function readDataFromFile(){if(!fileReader.result)return console.log("Primero debe seleccionar un archivo."),alert("Primero debe seleccionar un archivo."),!1;let t=fileReader.result.split("\n"),n=[];return(contentOriginal=[],t.forEach(t=>{n=t.split("\t"),contentOriginal.push(n)}),!validateContent(contentOriginal[0]))?(console.log("El contenido del archivo NO tiene formato válido."),alert("El contenido del archivo NO tiene formato válido."),!1):(console.log("***********************************"),console.log("Total filas iniciales: "+contentOriginal.length),deleteEmptyFinalLines(contentOriginal[0].length),contentOriginal.shift(),console.log("Encabezados eliminados: "+contentOriginal.length),!0)}function verifyTextFile(n){return n?n:(alert("No se ha seleccionado ningun archivo."),console.log("No se ha seleccionado ningun archivo."),null)}function validateContent(n){return n[0].trim()=="HFB"&&n[2].trim()=="ARTNO"&&n[3].trim()=="ARTNAME_UNICODE"&&n[6].trim()=="SALESMETHOD"&&n[5].trim()=="AVGSALES"&&n[10].trim()=="AVAILABLESTOCK"&&n[18].trim()=="SLID_H"?!0:!1}function deleteEmptyFinalLines(n){contentOriginal[contentOriginal.length-1].length<n&&(contentOriginal.pop(),deleteEmptyFinalLines(n))}function filterColumns(){let n=[];for(let t=0;t<contentOriginal.length;t++){const i=new StockControl(contentOriginal[t][0].trim(),contentOriginal[t][2].trim(),contentOriginal[t][3].trim(),contentOriginal[t][6].trim(),contentOriginal[t][5].trim(),contentOriginal[t][10].trim(),contentOriginal[t][18].trim());n.push(i)}contentOriginal=n}function verifySalesMethodTwo(){return contentOriginal.filter(n=>n.salesMethod==2)}function processContent(n){console.log("Estado seleccionado: "+n);switch(n){case ESTATE_ONE:content=removeHFB_Kitchens();console.log("removeHFB_Kitchens",content.length);content=filterAvgSales_MoreThanCero();console.log("filterAvgSales_MoreThanCero",content.length);content=filterAvailableStock_MoreThanCero();console.log("filterAvailableStock_MoreThanCero",content.length);divideAvailableStockByAvgSales();content=filterRotationRatio_MoreThanOne();console.log("filterRotationRatio_MoreThanOne",content.length);orderBySalesLocationLV();break;case ESTATE_TWO:content=selectOnlyHFB_Kitchens();console.log("selectOnlyHFB_Kitchens",content.length);content=filterAvgSales_MoreThanCero();console.log("filterAvgSales_MoreThanCero",content.length);content=filterAvailableStock_MoreThanCero();console.log("filterAvailableStock_MoreThanCero",content.length);divideAvailableStockByAvgSales();content=filterRotationRatio_MoreThanOne();console.log("filterRotationRatio_MoreThanOne",content.length);orderBySalesLocationLV();break;case ESTATE_THREE:content=filterAvgSales_LessThanEqualOne();console.log("filterAvgSales_LessThanEqualOne",content.length);content=filterAvailableStock_OnlyEqualOne();console.log("filterAvailableStock_OnlyEqualOne",content.length);orderBySalesLocationLV();break;default:console.log("Error inesperado, actualice la pagina.");alert("Error inesperado, actualice la pagina.");return}}function filterAvgSales_MoreThanCero(){return content.filter(n=>n.avgSales>0)}function filterAvgSales_LessThanEqualOne(){return content.filter(n=>n.avgSales<=1)}function filterAvailableStock_MoreThanCero(){return content.filter(n=>n.availableStock>0)}function filterAvailableStock_OnlyEqualOne(){return content.filter(n=>n.availableStock===1)}function removeHFB_Kitchens(){return content.filter(n=>n.hfb!==7)}function selectOnlyHFB_Kitchens(){return content.filter(n=>n.hfb===7)}function divideAvailableStockByAvgSales(){for(const n of content)n.rotationRatio=n.availableStock/n.avgSales}function filterRotationRatio_MoreThanOne(){return content.filter(n=>n.rotationRatio<1)}function findArticleNumber(){return this.articleNumber===BUSQUEDA}function orderBySalesLocationLV(){content.sort((n,t)=>n.salesLocationLV.localeCompare(t.salesLocationLV))}function showContent(){tableBody.innerHTML="";let n="",t=1;content.forEach(i=>{n+="<tr class=''>",n+="<td class='centrar'>",n+=t,n+="<\/td>",n+="<td class='centrar'>",n+=i.hfb,n+="<\/td>",n+="<td>",n+=i.articleName,n+="<\/td>",n+="<td class='centrar'>",n+=i.availableStock,n+="<\/td>",n+="<td>",n+=i.articleNumber,n+="<\/td>",n+="<td data-index='"+(t-1)+"' data-article-number='"+i.articleNumber+"' data-sales-location='"+i.salesLocationLV+"' class='centrar' contentEditable=true onblur='javascript:removeRowSelection(this)' onchange='javascript:changeRowData(this)'>",n+=i.salesLocationLV,n+="<\/td>",n+="<\/tr>",t++});tableBody.innerHTML+=n}function printDocument(){orderBySalesLocationLV();showContent();window.print()}function dataClick(n){const t=n.srcElement;t.dataset.articleNumber&&t.parentElement.classList.add("editable")}function removeRowSelection(n){if(console.log("Evento blur"),n.textContent!==n.dataset.salesLocation){if(content[n.dataset.index].articleNumber!==n.dataset.articleNumber){console.log("Ocurrió un error al actualizar la información");alert("Ocurrió un error al actualizar la información");return}content[n.dataset.index].salesLocationLV=n.textContent}n.parentElement.classList.remove("editable")}class StockControl{constructor(n,t,i,r,u,f,e){this.hfb=Number(n);this.articleNumber=t;this.articleName=i;this.salesMethod=Number(r.replace(",","."));this.avgSales=Number(u.replace(",","."));this.availableStock=Number(f.replace(",","."));this.salesLocationLV=e;this.rotationRatio=0}}const loadingFrame=document.getElementById("loading-frame"),loading=document.getElementById("loading"),fileSelector=document.getElementById("file-input"),radioButtons=document.getElementsByName("estate"),tableBody=document.getElementById("data-body"),processFile=document.getElementById("process-file"),printButton=document.getElementById("print-button"),ESTATE_ONE="estateOne",ESTATE_TWO="estateTwo",ESTATE_THREE="estateThree",fileReader=new FileReader;let contentOriginal=[],content=[],weekDay=new Date;fileSelector.addEventListener("change",openFile);fileReader.addEventListener("loadstart",()=>{loadingFrame.classList.remove("no-visible")});fileReader.addEventListener("progress",loadingInfo);fileReader.addEventListener("loadend",()=>{loadingFrame.classList.add("no-visible")});printButton.addEventListener("click",printDocument);processFile.addEventListener("click",loadFile);tableBody.addEventListener("click",dataClick);switch(weekDay.getDay()){case 1:case 4:document.getElementById(ESTATE_ONE).checked=!0;break;case 2:case 5:document.getElementById(ESTATE_TWO).checked=!0;break;case 3:case 6:document.getElementById(ESTATE_THREE).checked=!0;break;default:console.log("es Domingo?")}</script></body></html>