<!DOCTYPE html><html lang=es><head><meta charset=UTF-8 /><meta http-equiv=X-UA-Compatible content="IE=edge" /><meta name=viewport content="width=device-width, initial-scale=1.0" /><link rel=preconnect href=https://fonts.googleapis.com /><link rel=preconnect href=https://fonts.gstatic.com crossorigin /><link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel=stylesheet /><style>*{--background:white;--first-color:#0057a4;--second-color:#ffdb01;padding:0;margin:0;font-family:'Roboto',sans-serif;box-sizing:border-box}body{background-color:var(--background)}div.container{padding:.5rem;display:flex;flex-direction:column}.no-visible{display:none}.margen-alta-05{margin-top:.5rem}.ancho-100{width:100%}.margen-bajo{margin-bottom:.5rem}.centrar{text-align:center}h1,h4{margin:auto;padding:auto}div p.version{position:fixed;bottom:.5rem;right:.5rem;font-size:.7rem;color:#d3d3d3}h1{font-weight:bolder}ol{padding-left:2rem}input[type="file"],input[type='button']{display:none}label{display:inline-block}div label.custom-button{border-radius:4px;background-color:var(--first-color);color:var(--second-color);cursor:pointer;font-size:1rem;margin:.3rem auto;padding:.3rem .6rem;text-align:center}div label.custom-button:hover{background-color:var(--second-color);color:var(--first-color)}ul li{list-style-type:none;margin-bottom:.3rem;padding-left:auto}.custom-radio{display:inline-flex;align-items:center;cursor:pointer}label.custom-radio>input[type="radio"]{display:none}.custom-radio-show{position:relative;background-color:var(--first-color);border-radius:50%;width:1rem;height:1rem}.custom-radio-show::after{position:absolute;content:"";background-color:var(--background);top:12.5%;left:12.5%;width:75%;height:75%;border-radius:50%}.custom-radio>input[type="radio"]:checked~.custom-radio{background-color:var(--first-color);color:var(--second-color)}.custom-radio>input[type="radio"]:checked+.custom-radio-show::after{position:absolute;content:"";background-color:var(--second-color);top:12.5%;left:12.5%;width:75%;height:75%;border-radius:50%}span.custom-radio-text{margin-left:.3rem;padding:0 .2rem}div.loading-frame{position:absolute;top:0;left:0;width:100%;height:100%;backdrop-filter:blur(5px)}div.loading-frame div.loading{position:relative;background-color:var(--first-color);color:var(--second-color);text-align:center;max-width:40%;margin:auto;top:50%;padding:2rem;border-radius:5px;transform:translate(-0%,-50%);-webkit-transform:translate(-0%,-50%)}div.loading p{margin:auto;font-weight:bold;font-size:larger}table{border-collapse:collapse;border:2px solid var(--first-color)}th,td{border-bottom:1px solid #808080}tr:nth-last-of-type(2n+0){background-color:#d3d3d3}tbody tr:hover,tbody tr.editable{background-color:#ffdb01}tbody tr:hover td[contentEditable]{color:var(--second-color);background-color:var(--first-color)}.cabecera{background-color:var(--first-color);color:var(--second-color)}.resaltar{background-color:var(--second-color)}@media print{body,html{height:100%;background-color:#fff !important;color:#000 !important}.hide-print{display:none !important}.cabecera{background-color:#fff;color:#000}.borde{border:2px solid #000}}</style><title>Carga y lectura archivo de texto en Javascript</title></head><body><div class="container margen-alta-05"><h1 class=margen-bajo>Revisión de Inventario</h1><p class=hide-print><strong>Objetivo: </strong>Verificación de stock de referencias especificas.</p></div><div class="container hide-print"><ol><li><label for="">Seleccionar archivo de datos:</label><div class=ancho-100> <label class=custom-button id=upload-file-b for=file-input>Subir archivo...</label><input type=file id=file-input /></div></li><li><label class=margen-bajo for="">Seleccione el dia de la semana:</label><div><ul><li> <label for=estateOne class=custom-radio><input type=radio name=estate id=estateOne value=estateOne checked /> <span class="custom-radio custom-radio-show"></span> <span class="custom-radio custom-radio-text">Lunes / Jueves</span></label></li><li><label for=estateTwo class=custom-radio><input type=radio name=estate id=estateTwo value=estateTwo /><span class="custom-radio custom-radio-show"></span> <span class="custom-radio custom-radio-text">Martes / Viernes</span></label></li><li><label for=estateThree class=custom-radio><input type=radio name=estate id=estateThree value=estateThree /><span class="custom-radio custom-radio-show"></span> <span class="custom-radio custom-radio-text">Miercóles / Sábado</span></label></li></ul></div></li><li><label for="">Analizar el archivo seleccionado:</label><div> <label class=custom-button for=process-file>Procesar archivo</label><input id=process-file type=button value="Procesar Archivo" /></div></li><li><label for="">Editar ubicaciones de venta e imprimir el documento:</label><div> <label for="" class=custom-button id=print-button>Imprimir resultados</label></div></li></ol></div><div class="loading-frame no-visible" id=loading-frame><div class=loading><p id=loading>Cargando...</p></div></div><div class=container><table id=data-table class="borde margen-bajo"><thead><tr class="cabecera centrar borde"><th>No.</th><th>HFB</th><th>Descripción</th><th>Stock</th><th>Art. No.</th><th>Lugar de Venta</th></tr></thead><tbody id=data-body></tbody></table><div><h4 class="margen-bajo centrar">Final de la Tabla</h4></div></div><div><p class=version>Versión 1.2</p></div><script>function b(){for(let n=0;n<t.length;n++)if(t[n].checked)return t[n].value;return null}function v(n){console.clear();let t=n.target.files[0];(t=O(t),t)&&(f.readAsText(t),document.getElementById("upload-file-b").innerText=t.name)}function E(n){if(n.loaded&&n.total){const t=n.loaded/n.total*100,i=`Cargando... ${Math.round(t)}%`;r.innerText=i}}function A(){if(d.length<=0){if(!g())return;k();d=_()}h=d;let n=b();if(!n){console.log("Error en la seleccion del dia de la semana(estado).");return}p(n);F()}function g(){if(!f.result)return console.log("Primero debe seleccionar un archivo."),alert("Primero debe seleccionar un archivo."),!1;let t=f.result.split("\n"),n=[];return(d=[],t.forEach(t=>{n=t.split("\t"),d.push(n)}),!S(d[0]))?(console.log("El contenido del archivo NO tiene formato válido."),alert("El contenido del archivo NO tiene formato válido."),!1):(console.log("***********************************"),console.log("Total filas iniciales: "+d.length),T(d[0].length),d.shift(),console.log("Encabezados eliminados: "+d.length),!0)}function O(n){return n?(c.innerHTML="",n):(alert("No se ha seleccionado ningun archivo."),console.log("No se ha seleccionado ningun archivo."),null)}function S(n){return n[0].trim()=="HFB"&&n[2].trim()=="ARTNO"&&n[3].trim()=="ARTNAME_UNICODE"&&n[6].trim()=="SALESMETHOD"&&n[5].trim()=="AVGSALES"&&n[10].trim()=="AVAILABLESTOCK"&&n[18].trim()=="SLID_H"?!0:!1}function T(n){d[d.length-1].length<n&&(d.pop(),T(n))}function k(){let n=[];for(let t=0;t<d.length;t++){const i=new o(d[t][0].trim(),d[t][2].trim(),d[t][3].trim(),d[t][6].trim(),d[t][5].trim(),d[t][10].trim(),d[t][18].trim());n.push(i)}d=n}function _(){return d.filter(n=>n.l==2)}function p(n){console.log("Estado seleccionado: "+n);switch(n){case l:h=C();console.log("removeHFB_Kitchens",h.length);h=N();console.log("filterAvgSales_MoreThanCero",h.length);h=M();console.log("filterAvailableStock_MoreThanCero",h.length);L();h=B();console.log("filterRotationRatio_MoreThanOne",h.length);H();break;case s:h=D();console.log("selectOnlyHFB_Kitchens",h.length);h=N();console.log("filterAvgSales_MoreThanCero",h.length);h=M();console.log("filterAvailableStock_MoreThanCero",h.length);L();h=B();console.log("filterRotationRatio_MoreThanOne",h.length);H();break;case u:h=w();console.log("filterAvgSales_LessThanEqualOne",h.length);h=R();console.log("filterAvailableStock_OnlyEqualOne",h.length);H();break;default:console.log("Error inesperado, actualice la pagina.");alert("Error inesperado, actualice la pagina.");return}}function N(){return h.filter(n=>n.u>0)}function w(){return h.filter(n=>n.u<=1)}function M(){return h.filter(n=>n.h>0)}function R(){return h.filter(n=>n.h===1)}function C(){return h.filter(n=>n.t!==7)}function D(){return h.filter(n=>n.t===7)}function L(){for(const n of h)n.v=n.h/n.u}function B(){return h.filter(n=>n.v<1)}function y(){return this.o===BUSQUEDA}function H(){h.sort((n,t)=>n.m.localeCompare(t.m))}function F(){c.innerHTML="";let n="",t=1;h.forEach(i=>{n+="<tr class=''>",n+="<td class='centrar'>",n+=t,n+="<\/td>",n+="<td class='centrar'>",n+=i.t,n+="<\/td>",n+="<td>",n+=i.i,n+="<\/td>",n+="<td class='centrar'>",n+=i.h,n+="<\/td>",n+="<td>",n+=i.o,n+="<\/td>",n+="<td data-index='"+(t-1)+"' data-article-number='"+i.o+"' data-sales-location='"+i.m+"' class='centrar' contentEditable=true onblur='javascript:removeRowSelection(this)' onchange='javascript:changeRowData(this)'>",n+=i.m,n+="<\/td>",n+="<\/tr>",t++});c.innerHTML+=n}function z(){H();F();window.print()}function I(n){const t=n.srcElement;t.dataset.o&&t.parentElement.classList.add("editable")}function K(n){if(console.log("Evento blur"),n.textContent!==n.dataset.A){if(h[n.dataset.index].o!==n.dataset.o){console.log("Ocurrió un error al actualizar la información");alert("Ocurrió un error al actualizar la información");return}h[n.dataset.index].m=n.textContent}n.parentElement.classList.remove("editable")}class o{constructor(n,t,i,r,u,f,e){this.t=Number(n);this.o=t;this.i=i;this.l=Number(r.replace(",","."));this.u=Number(u.replace(",","."));this.h=Number(f.replace(",","."));this.m=e;this.v=0}}const e=document.getElementById("loading-frame"),r=document.getElementById("loading"),n=document.getElementById("file-input"),t=document.getElementsByName("estate"),c=document.getElementById("data-body"),a=document.getElementById("process-file"),i=document.getElementById("print-button"),l="estateOne",s="estateTwo",u="estateThree",f=new FileReader;let d=[],h=[],m=new Date;n.addEventListener("change",v);f.addEventListener("loadstart",()=>{e.classList.remove("no-visible")});f.addEventListener("progress",E);f.addEventListener("loadend",()=>{e.classList.add("no-visible")});i.addEventListener("click",z);a.addEventListener("click",A);c.addEventListener("click",I);switch(m.getDay()){case 1:case 4:document.getElementById(l).checked=!0;break;case 2:case 5:document.getElementById(s).checked=!0;break;case 3:case 6:document.getElementById(u).checked=!0;break;default:console.log("es Domingo?")}</script></body></html>