<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="autor" content="https://github.com/perseo1326" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
    <style>
*{--background:white;--first-color:#0057a4;--second-color:#ffdb01;--warning-color:rgba(255,165,0,1);--edicion-color:#ff5100;padding:0;margin:0;font-family:'Roboto',sans-serif;box-sizing:border-box}body{background-color:var(--background)}div.container{padding:0 .5rem;display:flex;flex-direction:column}.no-visible{display:none}.margen-alta-05{margin-top:.5rem}.ancho-100{width:100%}.margen-bajo{margin-bottom:.5rem}.centrar{text-align:center}h1,h4{margin:auto}div p.version{text-align:right;padding:0 1rem;font-size:.7rem;color:gray;cursor:pointer}h1{font-weight:bolder}ol{padding-left:2rem}input[type="file"],input[type='button']{display:none}label{display:inline-block}div label.custom-button{border-radius:4px;background-color:var(--first-color);color:var(--second-color);cursor:pointer;font-size:1rem;margin:.3rem auto;padding:.3rem .6rem;text-align:center}div label.custom-button:hover{background-color:var(--second-color);color:var(--first-color)}ul li{list-style-type:none;margin-bottom:.3rem}.custom-radio{display:inline-flex;align-items:center;cursor:pointer}label.custom-radio>input[type="radio"]{display:none}.custom-radio-show{position:relative;background-color:var(--first-color);border-radius:50%;width:1rem;height:1rem}.custom-radio-show::after{position:absolute;content:"";background-color:var(--background);top:12.5%;left:12.5%;width:75%;height:75%;border-radius:50%}.custom-radio>input[type="radio"]:checked ~ .custom-radio{background-color:var(--first-color);color:var(--second-color)}.custom-radio>input[type="radio"]:checked+.custom-radio-show::after{position:absolute;content:"";background-color:var(--second-color);top:12.5%;left:12.5%;width:75%;height:75%;border-radius:50%}span.custom-radio-text{margin-left:.3rem;padding:0 .2rem}div.loading-frame{position:absolute;top:0;left:0;width:100%;height:100%;backdrop-filter:blur(5px)}div.loading-frame div.loading{position:relative;background-color:var(--first-color);color:var(--second-color);text-align:center;max-width:40%;margin:auto;top:50%;padding:2rem;border-radius:5px;transform:translate(-0,-50%);-webkit-transform:translate(-0,-50%)}div.loading p{margin:auto;font-weight:bold;font-size:larger}table{border-collapse:collapse;border:2px solid var(--first-color)}th,td{border-bottom:1px solid gray}tr td{max-height:1rem}tr td input[type='text']{width:100%;text-align:center}tr:nth-last-of-type(2n+0){background-color:lightgray}tbody tr:hover{background-color:var(--second-color);cursor:grab}tbody tr.editable{background-color:var(--edicion-color);color:white;font-style:italic;cursor:text}tbody tr:hover td input[type='text']{color:var(--second-color);background-color:var(--first-color);cursor:text}tbody tr td.is-fictitious-location{background-color:var(--warning-color)}.cabecera{background-color:var(--first-color);color:var(--second-color)}@media print{body,html{background-color:transparent !important;color:black !important}.hide-print{display:none !important}.cabecera{background-color:#6d5454;color:black}.borde{border:2px solid black}td p.text-print-overflow-hidden{overflow:hidden;max-height:1rem;display:block}tbody tr td.is-fictitious-location{background-color:#c9c9c9;print-color-adjust:exact;-webkit-print-color-adjust:exact}p.version{print-color-adjust:exact;-webkit-print-color-adjust:exact;color:gray}}.unstyle{all:unset}
    </style>
    <title>Previsión Excesos de Inventario en el Full</title>
</head>
<body>
    <div class="container margen-alta-05 margen-bajo">
        <h1 class="margen-bajo">Previsión Excesos de Inventario en el Full</h1>
        <p class="hide-print"><strong>Objetivo: </strong>Verificación de stock para la prevención de excesos en el fulfillment.</p>
    </div>

    <div class="container hide-print margen-bajo">
        <ol>
            <li>
                <label class="" for="">Seleccionar archivo de datos:</label>
                <div class="ancho-100">
                    <label class="custom-button" id="upload-file-b" for="file-input">Subir archivo...</label>
                    <!-- The `multiple` attribute lets users select multiple files. -->
                    <!-- The attribute 'accept' allow to filter the files by their type -->
                    <input type="file" class="" id="file-input" value="" />
                </div>
            </li>
            <li>
                <label class="margen-bajo" for="">Seleccione el dia de la semana:</label>
                <div class="">
                    <ul>
                        <li>
                            <label for="estateOne" class="custom-radio">
                                <input type="radio" name="estate" id="estateOne" value="estateOne" checked>
                                <span class="custom-radio custom-radio-show"></span>
                                <span class="custom-radio custom-radio-text">Lunes / Jueves</span>
                            </label>
                        </li>
                        <li>
                            <label for="estateTwo" class="custom-radio">
                                <input type="radio" name="estate" id="estateTwo" value="estateTwo">
                                <span class="custom-radio custom-radio-show" ></span>
                                <span class="custom-radio custom-radio-text">Martes / Viernes</span>
                            </label>
                        </li>
                        <li>
                            <label for="estateThree" class="custom-radio">
                                <input type="radio" name="estate" id="estateThree" value="estateThree">
                                <span class="custom-radio custom-radio-show " ></span>
                                <span class="custom-radio custom-radio-text">Miercóles / Sábado</span>
                            </label>
                        </li>
                    </ul>
                </div>
            </li>

            <li>
                <label class="" for="">Analizar el archivo seleccionado:</label>
                <div>
                    <label class="custom-button" for="process-file">Procesar archivo</label>
                    <input id="process-file" type="button" value="Procesar Archivo" >
                </div>
            </li>

            <li>
                <label for="">Editar ubicaciones de venta e imprimir el documento:</label>
                <div>
                    <label for="" class="custom-button" id="print-button">Imprimir resultados</label>
                </div>            
            </li>
        </ol>
    </div>
        
    <div class="loading-frame no-visible" id="loading-frame">
        <div class="loading" >
            <p id="loading">Cargando...</p>
        </div>
    </div>

<div class="container">
    <table id="data-table" class="borde margen-bajo">
        <thead >
            <!-- let headers = ["HFB", "Descripción", "Art No.", "Lugar Venta"]; -->
            <tr class="cabecera centrar borde">
                <th class="">No.</th>
                <th>HFB</th>
                <th>Descripción</th>
                <th>Stock</th>
                <th>Art. No.</th>
                <th>Lugar de Venta</th>
            </tr>
        </thead>
        <tbody id="data-body">
            
        </tbody>
    </table>
    
    <div>
        <h4 class="margen-bajo centrar">Final de la Tabla</h4>
    </div>
</div>
<div title="https://github.com/perseo1326">
    <p class="version">Versión 1.4</p>
</div>
    <script>
class o{constructor(e,t,n,o,r,c,i){this.t=Number(e);this.o=t;this.i=n;this.l=Number(o.replace(",","."));this.u=Number(r.replace(",","."));this.h=Number(c.replace(",","."));this.m=i;this.v=0}}const e=document.getElementById("loading-frame");const r=document.getElementById("loading");const t=document.getElementById("file-input");const n=document.getElementsByName("estate");const c=document.getElementById("data-body");const i=document.getElementById("process-file");const a=document.getElementById("print-button");const l="estateOne";const s="estateTwo";const u="estateThree";const f="salesLocation";const d="articleNumber";const h=new FileReader;let m=[];let b=[];let v=new Date;t.addEventListener("change",O);h.addEventListener("loadstart",()=>{e.classList.remove("no-visible")});h.addEventListener("progress",T);h.addEventListener("loadend",()=>{e.classList.add("no-visible")});a.addEventListener("click",x);i.addEventListener("click",p);c.addEventListener("click",z);c.addEventListener("focusout",K);switch(v.getDay()){case 1:case 4:document.getElementById(l).checked=true;break;case 2:case 5:document.getElementById(s).checked=true;break;case 3:case 6:document.getElementById(u).checked=true;break;default:console.log("es Domingo?")}function A(){for(let e=0;e<n.length;e++){if(n[e].checked){return n[e].value}}return null}function O(e){console.clear();let t=e.target.files[0];t=g(t);if(!t){return}h.readAsText(t,"windows-1252");document.getElementById("upload-file-b").innerText=t.name}function T(e){if(e.loaded&&e.total){const t=e.loaded/e.total*100;const n=`Cargando... ${Math.round(t)}%`;r.innerText=n}}function p(){if(m.length<=0){if(!N()){return}S();m=_()}b=m;let e=A();if(!e){console.log("Error en la seleccion del dia de la semana(estado).");return}w(e);H()}function N(){if(!h.result){console.log("Primero debe seleccionar un archivo.");alert("Primero debe seleccionar un archivo.");return false}let e=h.result.split("\n");let t=[];m=[];e.forEach(e=>{t=e.split("\t");m.push(t)});if(!E(m[0])){b=m=[];console.log("El contenido del archivo NO tiene formato válido.");alert("El contenido del archivo NO tiene formato válido.");return false}k(m[0].length);m.shift();return true}function g(e){if(!e){alert("No se ha seleccionado ningun archivo.");console.log("No se ha seleccionado ningun archivo.");return null}c.innerHTML="";return e}function E(e){if(e[0].trim()=="HFB"&&e[2].trim()=="ARTNO"&&e[3].trim()=="ARTNAME_UNICODE"&&e[6].trim()=="SALESMETHOD"&&e[5].trim()=="AVGSALES"&&e[10].trim()=="AVAILABLESTOCK"&&e[18].trim()=="SLID_H"){return true}return false}function k(e){if(m[m.length-1].length<e){m.pop();k(e)}}function S(){let t=[];for(let e=0;e<m.length;e++){const n=new o(m[e][0].trim(),m[e][2].trim(),m[e][3].trim(),m[e][6].trim(),m[e][5].trim(),m[e][10].trim(),m[e][18].trim());t.push(n)}m=t}function _(){return m.filter(e=>{return e.l==2})}function w(e){switch(e){case l:b=F();console.log("removeHFB_Kitchens",b.length);b=M();console.log("filterAvgSales_MoreThanCero",b.length);b=C();console.log("filterAvailableStock_MoreThanCero",b.length);L();b=R();console.log("filterRotationRatio_MoreThanOne",b.length);D();break;case s:b=P();console.log("selectOnlyHFB_Kitchens",b.length);b=M();console.log("filterAvgSales_MoreThanCero",b.length);b=C();console.log("filterAvailableStock_MoreThanCero",b.length);L();b=R();console.log("filterRotationRatio_MoreThanOne",b.length);D();break;case u:b=y();console.log("filterAvgSales_LessThanEqualOne",b.length);b=B();console.log("filterAvailableStock_OnlyEqualOne",b.length);D();break;default:console.log("Error inesperado, actualice la pagina.");alert("Error inesperado, actualice la pagina.");return}}function M(){return b.filter(e=>{return e.u>0})}function y(){return b.filter(e=>{return e.u<=1})}function C(){return b.filter(e=>{return e.h>0})}function B(){return b.filter(e=>{return e.h===1})}function F(){return b.filter(e=>{return e.t!==7})}function P(){return b.filter(e=>{return e.t===7})}function L(){for(const e of b){e.v=e.h/e.u}}function R(){return b.filter(e=>{return e.v<1})}function D(){b.sort((e,t)=>e.m.localeCompare(t.m))}function H(){c.innerHTML="";let t="";let n=1;let o="";b.forEach(e=>{o="";t+="<tr class=''>";t+="<td class='centrar'>";t+=n;t+="</td>";t+="<td class='centrar'>";t+=e.t;t+="</td>";t+="<td><p class='text-print-overflow-hidden'>";t+=e.i;t+="</p></td>";t+="<td class='centrar'>";t+=e.h;t+="</td>";t+="<td>";t+=e.o;t+="</td>";if(I(e.m)){o="is-fictitious-location"}t+="<td data-index='"+(n-1)+"' data-article-number='"+e.o+"' data-sales-location='"+e.m+"' class='centrar "+o+"' >";t+="<input type='text' name='' class='unstyle' id='"+e.o+"' ";t+="value='"+e.m+"' ";t+=" />";t+="</td>";t+="</tr>";n++});c.innerHTML+=t}function I(e){const t=/950150/;const n=/950250/;const o=/[a-z]/i;if(!e||t.test(e)||n.test(e)||o.test(e)){return true}return false}function x(){D();H();window.print()}function z(e){const t=e.srcElement;if(t.tagName==="INPUT"&&t.className==="unstyle"){t.parentElement.parentElement.classList.add("editable")}}function K(e){const t=e.srcElement;if(t.tagName==="INPUT"&&t.className==="unstyle"){if(t.value!==t.parentElement.dataset[f]){if(b[t.parentElement.dataset.index].o!==t.parentElement.dataset[d]){console.log("Ocurrió un error al actualizar la información");alert("Ocurrió un error al actualizar la información");t.value=t.parentElement.dataset[f]}else{b[t.parentElement.dataset.index].m=t.value;if(I(t.value)){t.parentElement.classList.add("is-fictitious-location")}else{t.parentElement.classList.remove("is-fictitious-location")}}}t.parentElement.parentElement.classList.remove("editable")}}
    </script>
</body>
</html>